<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>行事曆 (FullCalendar)</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <div id="topNavbar"></div>

  <main class="container py-4">
    <h2>活動行事曆</h2>
    <div id="calendar"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/navbar.js"></script>
  <script>
    (function(){
      document.addEventListener('DOMContentLoaded', async function() {
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          height: 650,
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
          },
          eventClick: function(info) {
            const id = info.event.id;
            apiGet(`/api/activities.php?action=get&id=${id}`).then(res => {
              if(res.success) {
                const a = res.data;
                alert(`${a.title}\n${a.description || ''}\n${formatDateRange(a.start_time,a.end_time)}`);
              } else showAlert('','danger',res.message||'無法取得活動');
            });
          },
          events: async function(fetchInfo, successCallback, failureCallback) {
            try {
              const res = await apiGet('/api/activities.php?action=events&start='+fetchInfo.startStr+'&end='+fetchInfo.endStr);
              if (!res.success) return successCallback([]);
              successCallback(res.data || []);
            } catch(err) {
              failureCallback(err);
            }
          }
        });
        calendar.render();
      });
    })();
  </script>
</body>
</html>